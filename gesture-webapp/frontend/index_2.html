<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹åŠ¿é­”æ³•å±‹ - Gesture Magic Hub</title>
    <!-- å¼•å…¥ä¸€ä¸ªå›¾æ ‡åº“ï¼Œç”¨äºæ™ºèƒ½å®¶å±…ç­‰æ¨¡æ‹Ÿ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #f0f4f8;
            --secondary-bg: #ffffff;
            --text-color: #333;
            --header-bg: #2c3e50;
            --header-text: #ecf0f1;
            --accent-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background-color: var(--primary-bg);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background-color: var(--header-bg); color: var(--header-text); padding: 20px 0; text-align: center; border-bottom: 4px solid var(--accent-color); }
        header h1 { margin: 0; font-size: 2.5rem; }
        header p { margin: 5px 0 0; font-size: 1.1rem; opacity: 0.9; }
        .main-app { display: flex; flex-wrap: wrap; gap: 30px; margin-top: 30px; background: var(--secondary-bg); padding: 20px; border-radius: var(--border-radius); box-shadow: var(--card-shadow); }
        .video-container { flex: 1; min-width: 300px; display: flex; flex-direction: column; align-items: center; }
        .video-container h2 { margin-top: 0; color: var(--accent-color); }
        #video-feed { width: 100%; max-width: 640px; height: auto; border-radius: var(--border-radius); border: 2px solid #ddd; background-color: #000; }
        .result-container { flex: 1; min-width: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        #status { font-size: 1.2rem; color: #7f8c8d; margin-bottom: 20px; }
        #gesture-label { font-size: 1.5rem; font-weight: bold; }
        #gesture-result { font-size: 8rem; font-weight: bold; color: var(--accent-color); margin: 10px 0; line-height: 1; }
        
        /* === æ–°å¢æ ·å¼ï¼šäº¤äº’åŒºåŸŸ === */
        .interactive-section {
            margin-top: 30px;
            background: var(--secondary-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        #mode-selector {
            display: block;
            width: 100%;
            padding: 10px;
            font-size: 1.2rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--accent-color);
            margin-bottom: 20px;
        }
        #interactive-area {
            min-height: 200px;
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
        }
        .interactive-panel {
            width: 100%;
        }
        /* é»˜è®¤éšè—æ‰€æœ‰é¢æ¿ */
        .interactive-panel { display: none; }

        /* ç‰¹å®šç©æ³•çš„æ ·å¼ */
        /* åª’ä½“æ’­æ”¾å™¨ */
        #media-player-panel .icon { font-size: 4rem; margin-bottom: 10px; }
        #media-player-panel .status-text { font-size: 1.5rem; font-weight: bold; }
        #media-player-panel .volume-bar { width: 80%; height: 20px; background: #eee; border-radius: 10px; overflow: hidden; margin: 10px auto; }
        #media-player-volume { height: 100%; background: var(--accent-color); width: 50%; transition: width 0.2s; }
        
        /* PPT æ¼”ç¤º */
        #presentation-panel .slide { font-size: 3rem; font-weight: bold; }
        
        /* æ™ºèƒ½å®¶å±… */
        #smart-home-panel { display: flex; justify-content: space-around; align-items: center; }
        .device { text-align: center; }
        .device .icon { font-size: 4rem; cursor: pointer; transition: color 0.3s; }
        .device .icon.on { color: var(--warning-color); }
        .device .label { font-size: 1.2rem; margin-top: 10px; }

        /* é­”æ³•å’’è¯­ */
        #magic-spell-panel .spell-log { font-family: 'Courier New', Courier, monospace; font-size: 1.5rem; background: #2d3436; color: #00b894; padding: 15px; border-radius: 5px; min-height: 50px; }
        #magic-spell-panel .feedback { margin-top: 15px; font-size: 1.5rem; font-weight: bold; color: var(--success-color); }

        /* PINç è¾“å…¥ */
        #pin-input-panel #pin-display { font-size: 3rem; letter-spacing: 10px; background: #eee; padding: 10px 20px; border-radius: 5px; }

        .features-section { margin-top: 40px; }
        .category-title { font-size: 2rem; color: var(--header-bg); border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; margin-bottom: 20px; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .feature-card { background-color: var(--secondary-bg); border-radius: var(--border-radius); box-shadow: var(--card-shadow); padding: 25px; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .feature-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15); }
        .feature-card h3 { margin-top: 0; color: var(--accent-color); font-size: 1.5rem; }
        .feature-card p { margin-bottom: 15px; }
        .feature-card ul { list-style-type: none; padding-left: 0; }
        .feature-card li { position: relative; padding-left: 25px; margin-bottom: 10px; }
        .feature-card li::before { content: 'âœ“'; position: absolute; left: 0; color: var(--accent-color); font-weight: bold; }
        footer { text-align: center; padding: 20px; margin-top: 40px; color: #7f8c8d; }
    </style>
</head>
<body>

    <header>
        <h1>æ‰‹åŠ¿é­”æ³•å±‹ - Gesture Magic Hub</h1>
        <p>ä¸€ä¸ªåŸºäºå®æ—¶æ‰‹åŠ¿è¯†åˆ«çš„äº’åŠ¨åº”ç”¨å±•ç¤ºå¹³å°</p>
    </header>

    <div class="container">
        <!-- ä¸»åº”ç”¨äº¤äº’åŒº -->
        <section class="main-app">
            <div class="video-container">
                <h2>å®æ—¶æ‘„åƒå¤´</h2>
                <img id="video-feed" src="http://127.0.0.1:8000/video_feed" alt="æ­£åœ¨åŠ è½½æ‘„åƒå¤´ç”»é¢...">
            </div>
            <div class="result-container">
                <div id="status">æ­£åœ¨è¿æ¥åˆ°åç«¯...</div>
                <div id="gesture-label">å½“å‰è¯†åˆ«æ‰‹åŠ¿</div>
                <div id="gesture-result">...</div>
            </div>
        </section>

        <!-- === æ–°å¢ï¼šç©æ³•é€‰æ‹©å’Œäº¤äº’åŒºåŸŸ === -->
        <section class="interactive-section">
            <select id="mode-selector">
                <option value="none" selected>-- è¯·é€‰æ‹©ä¸€ä¸ªç©æ³•æ¨¡å¼ --</option>
                <option value="media-player">ç©æ³•å››ï¼šéæ¥è§¦å¼åª’ä½“æ’­æ”¾å™¨</option>
                <option value="presentation">ç©æ³•äº”ï¼šæ¼”ç¤ºæ–‡ç¨¿é¥æ§å™¨</option>
                <option value="smart-home">ç©æ³•å…­ï¼šæ™ºèƒ½å®¶å±…å¿«æ·æŒ‡ä»¤</option>
                <option value="magic-spell">ç©æ³•ä¸‰ï¼šå¿æœ¯ç»“å°æ¨¡æ‹Ÿå™¨</option>
                <option value="pin-input">ç©æ³•å…«ï¼šéæ¥è§¦å¼PINç è¾“å…¥</option>
            </select>
            <div id="interactive-area">
                <p>è¯·å…ˆåœ¨ä¸Šæ–¹é€‰æ‹©ä¸€ä¸ªç©æ³•æ¨¡å¼ï¼Œç„¶åé€šè¿‡æ‰‹åŠ¿è¿›è¡Œäº’åŠ¨ã€‚</p>

                <!-- åª’ä½“æ’­æ”¾å™¨é¢æ¿ -->
                <div id="media-player-panel" class="interactive-panel">
                    <div id="media-player-icon" class="icon fa-solid fa-play"></div>
                    <div id="media-player-status" class="status-text">å·²æš‚åœ</div>
                    <div class="volume-bar">
                        <div id="media-player-volume"></div>
                    </div>
                </div>

                <!-- PPT æ¼”ç¤ºé¢æ¿ -->
                <div id="presentation-panel" class="interactive-panel">
                    <div id="presentation-slide" class="slide">ç¬¬ 1 é¡µ</div>
                </div>

                <!-- æ™ºèƒ½å®¶å±…é¢æ¿ -->
                <div id="smart-home-panel" class="interactive-panel">
                    <div class="device">
                        <i id="light-icon" class="icon fa-solid fa-lightbulb"></i>
                        <div class="label">ä¹¦æˆ¿ç¯: <span id="light-status">å…³é—­</span></div>
                    </div>
                    <div class="device">
                        <i id="ac-icon" class="icon fa-solid fa-snowflake"></i>
                        <div class="label">ç©ºè°ƒ: <span id="ac-status">å…³é—­</span></div>
                    </div>
                </div>

                <!-- å¿æœ¯ç»“å°é¢æ¿ -->
                <div id="magic-spell-panel" class="interactive-panel">
                    <div style="display: flex; gap: 20px; width: 100%;">
                        <div style="flex: 1;">
                            <h3>å½“å‰ç»“å°åºåˆ—:</h3>
                            <div id="spell-log" class="spell-log" style="font-size: 1.8rem; text-align: center;"></div>
                            <div id="spell-feedback" class="feedback" style="min-height: 30px; margin-top: 15px; font-size: 1.8rem; font-weight: bold; color: var(--success-color);"></div>
                        </div>
                        <div style="flex: 1; border-left: 2px solid #ddd; padding-left: 20px;">
                            <h3>å¿æœ¯å·è½´ (Jutsu Scroll)</h3>
                            <ul id="jutsu-list" style="list-style-type: none; padding: 0; font-size: 1.1rem;">
                                <!-- å¿æœ¯åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- PINç è¾“å…¥é¢æ¿ -->
                <div id="pin-input-panel" class="interactive-panel">
                    <h3>PINç  (æ‰‹åŠ¿0æ¸…ç©º): </h3>
                    <div id="pin-display"></div>
                </div>
            </div>
        </section>
        
        <!-- æ‰€æœ‰ç©æ³•å±•ç¤ºåŒº (ä¿æŒä¸å˜) -->
        <section class="features-section">
            <h2 class="category-title">ğŸ® æ¸¸æˆä¸å¨±ä¹ (Gamification & Entertainment)</h2>
            <div class="feature-grid">
                <!-- ... çœç•¥æœªå˜çš„ç©æ³•å¡ç‰‡ ... -->
            </div>
            
            <h2 class="category-title" style="margin-top: 40px;">âš™ï¸ æ™ºèƒ½æ§åˆ¶ä¸æ•ˆç‡å·¥å…· (Smart Control & Productivity)</h2>
            <div class="feature-grid">
                 <!-- ... çœç•¥æœªå˜çš„ç©æ³•å¡ç‰‡ ... -->
            </div>

            <h2 class="category-title" style="margin-top: 40px;">â¤ï¸ æ•™è‚²ä¸è¾…åŠ©åŠŸèƒ½ (Education & Accessibility)</h2>
            <div class="feature-grid">
                 <!-- ... çœç•¥æœªå˜çš„ç©æ³•å¡ç‰‡ ... -->
            </div>
        </section>
    </div>
    
    <footer>
        <p>Â© 2024 Gesture WebApp Project. All ideas presented for demonstration purposes.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            // === 1. è·å–æ‰€æœ‰éœ€è¦çš„ DOM å…ƒç´  ===
            const statusEl = document.getElementById('status');
            const gestureResultEl = document.getElementById('gesture-result');
            const modeSelector = document.getElementById('mode-selector');
            const interactiveArea = document.getElementById('interactive-area');
            const allPanels = document.querySelectorAll('.interactive-panel');
            
            // åª’ä½“æ’­æ”¾å™¨å…ƒç´ 
            const mediaPlayerPanel = document.getElementById('media-player-panel');
            const mediaPlayerIcon = document.getElementById('media-player-icon');
            const mediaPlayerStatus = document.getElementById('media-player-status');
            const mediaPlayerVolume = document.getElementById('media-player-volume');

            // PPT å…ƒç´ 
            const presentationPanel = document.getElementById('presentation-panel');
            const presentationSlide = document.getElementById('presentation-slide');

            // æ™ºèƒ½å®¶å±…å…ƒç´ 
            const smartHomePanel = document.getElementById('smart-home-panel');
            const lightIcon = document.getElementById('light-icon');
            const lightStatus = document.getElementById('light-status');
            const acIcon = document.getElementById('ac-icon');
            const acStatus = document.getElementById('ac-status');
            
            // é­”æ³•å’’è¯­å…ƒç´ 
            const magicSpellPanel = document.getElementById('magic-spell-panel');
            const spellLog = document.getElementById('spell-log');
            const spellFeedback = document.getElementById('spell-feedback');

            // PINç å…ƒç´ 
            const pinInputPanel = document.getElementById('pin-input-panel');
            const pinDisplay = document.getElementById('pin-display');

            // === 2. åˆå§‹åŒ–çŠ¶æ€å˜é‡ ===
            let lastGesture = null; // ç”¨äºé˜²æ­¢é‡å¤è§¦å‘
            let currentMode = 'none'; // å½“å‰ç©æ³•æ¨¡å¼
            let ninjutsu = {}; // ç”¨äºå­˜å‚¨å¿æœ¯å®šä¹‰
            
            // å„æ¨¡å¼çš„çŠ¶æ€
            let isPlaying = false;
            let volume = 50;
            let currentSlide = 1;
            let isLightOn = false;
            let isAcOn = false;
            let spellSequence = [];
            let pinCode = "";

            // === 3. æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ===

            // æ¨¡å¼åˆ‡æ¢å‡½æ•°
            modeSelector.addEventListener('change', (e) => {
                currentMode = e.target.value;
                // éšè—æ‰€æœ‰é¢æ¿
                allPanels.forEach(panel => panel.style.display = 'none');
                interactiveArea.querySelector('p').style.display = 'none'; // éšè—åˆå§‹æç¤º

                // é‡ç½®æ‰€æœ‰çŠ¶æ€
                resetAllStates();

                // æ˜¾ç¤ºå¯¹åº”æ¨¡å¼çš„é¢æ¿
                switch (currentMode) {
                    case 'media-player':
                        mediaPlayerPanel.style.display = 'block';
                        break;
                    case 'presentation':
                        presentationPanel.style.display = 'block';
                        break;
                    case 'smart-home':
                        smartHomePanel.style.display = 'flex';
                        break;
                    case 'magic-spell':
                        magicSpellPanel.style.display = 'block';
                        break;
                    case 'pin-input':
                        pinInputPanel.style.display = 'block';
                        break;
                    default:
                         interactiveArea.querySelector('p').style.display = 'block';
                }
            });

            function resetAllStates() {
                // åª’ä½“æ’­æ”¾å™¨
                isPlaying = false;
                volume = 50;
                mediaPlayerIcon.className = 'icon fa-solid fa-play';
                mediaPlayerStatus.textContent = 'å·²æš‚åœ';
                mediaPlayerVolume.style.width = '50%';
                
                // PPT
                currentSlide = 1;
                presentationSlide.textContent = 'ç¬¬ 1 é¡µ';

                // æ™ºèƒ½å®¶å±…
                isLightOn = false;
                isAcOn = false;
                lightIcon.classList.remove('on');
                lightStatus.textContent = 'å…³é—­';
                acIcon.classList.remove('on');
                acStatus.textContent = 'å…³é—­';

                // å¿æœ¯ç»“å°åˆå§‹åŒ–
                ninjutsu = {
                    'è±ªç«çƒä¹‹æœ¯ (Fire Ball)': '7-1-5', // ç®€åŒ–ç‰ˆï¼Œä½ å¯ä»¥è‡ªå®šä¹‰
                    'æ°´é¾™å¼¹ä¹‹æœ¯ (Water Dragon)': '2-1-3-4',
                    'åƒé¸Ÿ (Chidori)': '8-1-8-1',
                    'å½±åˆ†èº«ä¹‹æœ¯ (Shadow Clone)': '9-9-9',
                    'é€šçµä¹‹æœ¯ (Summoning)': '4-3-2-1-0'
                };
                spellSequence = [];
                spellLog.textContent = '...';
                spellFeedback.textContent = 'å‡†å¤‡ç»“å°...';

                // åŠ¨æ€ç”Ÿæˆå¿æœ¯åˆ—è¡¨
                const jutsuListEl = document.getElementById('jutsu-list');
                jutsuListEl.innerHTML = ''; // æ¸…ç©ºæ—§åˆ—è¡¨
                for (const name in ninjutsu) {
                    const sequence = ninjutsu[name];
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>${name}:</strong> ç»“å°é¡ºåº -> ${sequence}`;
                    listItem.style.marginBottom = '10px';
                    jutsuListEl.appendChild(listItem);
                }

                // PIN
                pinCode = "";
                pinDisplay.textContent = "";
            }

            // WebSocket è¿æ¥é€»è¾‘
            const wsUrl = 'ws://127.0.0.1:8000/ws';
            
            function connect() {
                const ws = new WebSocket(wsUrl);

                ws.onopen = () => {
                    statusEl.textContent = 'âœ… å·²è¿æ¥åˆ°åç«¯';
                    statusEl.style.color = 'var(--success-color)';
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    // æ›´æ–°UIæ˜¾ç¤ºå½“å‰æ‰‹åŠ¿
                    const gesture = data.gesture;
                    gestureResultEl.textContent = (gesture === null || gesture === 'Unknown') ? '?' : gesture;
                    gestureResultEl.style.color = (gesture === null || gesture === 'Unknown') ? '#95a5a6' : 'var(--accent-color)';

                    // === æ ¸å¿ƒé€»è¾‘ï¼šåªæœ‰å½“æ‰‹åŠ¿å‘ç”Ÿå˜åŒ–æ—¶æ‰è§¦å‘äº‹ä»¶ ===
                    if (gesture === lastGesture || gesture === 'Unknown' || gesture === null) {
                        return; // å¦‚æœæ‰‹åŠ¿æœªå˜æˆ–æœªçŸ¥ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
                    }
                    lastGesture = gesture; // æ›´æ–°ä¸Šä¸€ä¸ªæ‰‹åŠ¿

                    // æ ¹æ®å½“å‰æ¨¡å¼æ‰§è¡Œä¸åŒæ“ä½œ
                    handleGesture(gesture);
                };

                ws.onclose = () => {
                    statusEl.textContent = 'ğŸ”Œ è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨å°è¯•é‡è¿...';
                    statusEl.style.color = '#e74c3c';
                    gestureResultEl.textContent = '...';
                    lastGesture = null;
                    setTimeout(connect, 3000);
                };

                ws.onerror = (error) => {
                    statusEl.textContent = 'âŒ è¿æ¥å¤±è´¥';
                    statusEl.style.color = '#e74c3c';
                    ws.close();
                };
            }
            
            // æ‰‹åŠ¿å¤„ç†åˆ†å‘
            function handleGesture(gesture) {
                switch (currentMode) {
                    case 'media-player': handleMediaPlayer(gesture); break;
                    case 'presentation': handlePresentation(gesture); break;
                    case 'smart-home': handleSmartHome(gesture); break;
                    case 'magic-spell': handleMagicSpell(gesture); break;
                    case 'pin-input': handlePinInput(gesture); break;
                }
            }

            // === 4. å„ä¸ªæ¨¡å¼çš„å…·ä½“å®ç° ===

            function handleMediaPlayer(gesture) {
                switch (gesture) {
                    case '1': // æ’­æ”¾/æš‚åœ
                        isPlaying = !isPlaying;
                        mediaPlayerIcon.className = isPlaying ? 'icon fa-solid fa-pause' : 'icon fa-solid fa-play';
                        mediaPlayerStatus.textContent = isPlaying ? 'æ­£åœ¨æ’­æ”¾' : 'å·²æš‚åœ';
                        break;
                    case '5': // éŸ³é‡+
                        volume = Math.min(100, volume + 10);
                        mediaPlayerVolume.style.width = volume + '%';
                        break;
                    case '4': // éŸ³é‡-
                        volume = Math.max(0, volume - 10);
                        mediaPlayerVolume.style.width = volume + '%';
                        break;
                    case '2': // ä¸‹ä¸€é¦–
                        mediaPlayerStatus.textContent = 'ä¸‹ä¸€é¦–';
                        break;
                    case '3': // ä¸Šä¸€é¦–
                        mediaPlayerStatus.textContent = 'ä¸Šä¸€é¦–';
                        break;
                    case '0': // é™éŸ³
                        volume = 0;
                        mediaPlayerVolume.style.width = '0%';
                        break;
                }
            }

            function handlePresentation(gesture) {
                switch (gesture) {
                    case '1': // ä¸‹ä¸€é¡µ
                        currentSlide++;
                        break;
                    case '2': // ä¸Šä¸€é¡µ
                        currentSlide = Math.max(1, currentSlide - 1);
                        break;
                    case '5': // è·³è½¬åˆ°ç¬¬5é¡µ
                        currentSlide = 5;
                        break;
                    case '0': // é»‘å±
                         presentationSlide.textContent = 'é»‘å±æ¨¡å¼';
                         return; // é¿å…è¦†ç›–
                }
                presentationSlide.textContent = `ç¬¬ ${currentSlide} é¡µ`;
            }

            function handleSmartHome(gesture) {
                switch (gesture) {
                    case '1': // å¼€/å…³ç¯
                        isLightOn = !isLightOn;
                        lightIcon.classList.toggle('on', isLightOn);
                        lightStatus.textContent = isLightOn ? 'å¼€å¯' : 'å…³é—­';
                        break;
                    case '2': // å¼€/å…³ç©ºè°ƒ
                        isAcOn = !isAcOn;
                        acIcon.classList.toggle('on', isAcOn);
                        acStatus.textContent = isAcOn ? 'å¼€å¯ (22Â°C)' : 'å…³é—­';
                        break;
                }
            }

            //  function handleMagicSpell(gesture) {
            //     spellFeedback.textContent = ''; // æ¸…é™¤ä¸Šæ¬¡åé¦ˆ
            //     spellSequence.push(gesture);
            //     spellLog.textContent = spellSequence.join(' -> ');

            //     // æ£€æŸ¥å’’è¯­
            //     const sequenceStr = spellSequence.join('-');
            //     if (sequenceStr.endsWith('7-3-5')) {
            //         spellFeedback.textContent = 'ğŸ”¥ ç«çƒæœ¯å·²é‡Šæ”¾ï¼';
            //         spellSequence = []; // æˆåŠŸåæ¸…ç©º
            //     } else if (sequenceStr.endsWith('1-2-3-4')) {
            //         spellFeedback.textContent = 'ğŸ›¡ï¸ æŠ¤ç›¾å·²ç”Ÿæˆï¼';
            //         spellSequence = [];
            //     }

            //     // é˜²æ­¢åºåˆ—è¿‡é•¿
            //     if (spellSequence.length > 10) {
            //         spellSequence.shift(); // ç§»é™¤æœ€æ—©çš„ä¸€ä¸ª
            //     }
            // }

            let jutsuTimeout = null; // ç”¨äºè¶…æ—¶é‡ç½®

            function handleMagicSpell(gesture) { // å‡½æ•°åä¿æŒä¸å˜ä»¥å…¼å®¹äº‹ä»¶åˆ†å‘
                clearTimeout(jutsuTimeout); // æ¯æ¬¡æœ‰æ–°è¾“å…¥ï¼Œå°±é‡ç½®è¶…æ—¶è®¡æ—¶å™¨

                spellSequence.push(gesture);
                spellLog.textContent = spellSequence.join(' â†’ ');

                let jutsuFound = false;
                // æ£€æŸ¥å½“å‰åºåˆ—æ˜¯å¦åŒ¹é…ä»»ä½•ä¸€ä¸ªå¿æœ¯
                for (const name in ninjutsu) {
                    const requiredSequence = ninjutsu[name];
                    if (spellSequence.join('-') === requiredSequence) {
                        // å®Œå…¨åŒ¹é…ï¼
                        spellFeedback.textContent = `å¿æœ¯å‘åŠ¨æˆåŠŸ: ${name}ï¼`;
                        spellFeedback.style.color = 'var(--success-color)';
                        
                        // æ¨¡æ‹Ÿç‰¹æ•ˆ
                        const icons = {'ç«':'ğŸ”¥', 'æ°´':'ğŸ’§', 'é›·':'âš¡ï¸', 'å½±':'ğŸ‘¥', 'é€š':'ğŸ¸'};
                        const icon = Object.keys(icons).find(key => name.includes(key)) || 'âœ¨';
                        spellLog.textContent = icon.repeat(5);

                        spellSequence = []; // æˆåŠŸåæ¸…ç©ºåºåˆ—
                        jutsuFound = true;
                        break; // æ‰¾åˆ°åå°±ä¸ç”¨å†æ£€æŸ¥äº†
                    }
                }

                if (!jutsuFound) {
                    // å¦‚æœæ²¡æœ‰åŒ¹é…æˆåŠŸï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                    spellFeedback.textContent = '...ç»§ç»­ç»“å°...';
                    spellFeedback.style.color = 'var(--text-color)';
                }

                // è®¾ç½®ä¸€ä¸ªè¶…æ—¶ï¼Œå¦‚æœ3ç§’å†…æ²¡æœ‰æ–°çš„ç»“å°ï¼Œåˆ™åºåˆ—è‡ªåŠ¨é‡ç½®
                jutsuTimeout = setTimeout(() => {
                    spellSequence = [];
                    spellLog.textContent = '...';
                    spellFeedback.textContent = 'æŸ¥å…‹æ‹‰ä¸­æ–­ï¼Œç»“å°å¤±è´¥ã€‚';
                    spellFeedback.style.color = 'var(--warning-color)';
                }, 3000); // 3ç§’è¶…æ—¶
            }

            function handlePinInput(gesture) {
                if (gesture === '0') {
                    pinCode = "";
                } else if (pinCode.length < 6) { // æœ€å¤š6ä½
                    pinCode += gesture;
                }
                pinDisplay.textContent = '*'.repeat(pinCode.length);
            }


            // åˆå§‹è¿æ¥
            connect();
        });
    </script>
</body>
</html>